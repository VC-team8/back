#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-commit checks..."
echo ""

# Check if MongoDB is running
echo "📦 Checking MongoDB connection..."
if ! curl -s http://localhost:27017 > /dev/null 2>&1; then
    echo "❌ MongoDB is not running!"
    echo "Please start MongoDB:"
    echo "  docker run -d -p 27017:27017 mongo:latest"
    echo "  or: mongod"
    exit 1
fi
echo "✅ MongoDB is running"
echo ""

# Run linter
echo "🔎 Running ESLint..."
cd back && npm run lint
if [ $? -ne 0 ]; then
    echo "❌ ESLint failed. Please fix linting errors."
    exit 1
fi
echo "✅ Linting passed"
echo ""

# Run integration tests
echo "🧪 Running integration tests..."
cd back && npm run test:e2e
if [ $? -ne 0 ]; then
    echo "❌ Tests failed. Please fix failing tests before committing."
    exit 1
fi
echo "✅ All tests passed"
echo ""

echo "✨ Pre-commit checks completed successfully!"

