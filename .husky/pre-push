#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."
echo ""

# Check if MongoDB is running
echo "ğŸ“¦ Checking MongoDB connection..."
if ! curl -s http://localhost:27017 > /dev/null 2>&1; then
    echo "âŒ MongoDB is not running!"
    echo "Please start MongoDB before pushing."
    exit 1
fi
echo "âœ… MongoDB is running"
echo ""

# Run full test suite with coverage
echo "ğŸ§ª Running full test suite with coverage..."
cd back && npm run test:e2e -- --coverage
if [ $? -ne 0 ]; then
    echo "âŒ Tests failed. Please fix failing tests before pushing."
    exit 1
fi
echo "âœ… All tests passed with coverage"
echo ""

echo "âœ¨ Pre-push checks completed successfully!"
echo "ğŸ“¤ Pushing to remote..."

